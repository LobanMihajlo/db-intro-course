# Конспект лекції - SQL частина 1 - CRUD операції

## 1. SQL як стандарт
- SQL (Structured Query Language) — це не конкретна мова програмування, а стандарт для роботи з базами даних.
- Різні системи управління базами даних (СУБД) імплементують цей стандарт по-своєму.
- Існують відмінності у синтаксисі та можливостях між різними СУБД. Запит, який успішно виконується в PostgreSQL, може не працювати в MySQL.
- SQL має багато версій стандарту, більшість СУБД підтримують стандарт SQL-92 та частково новіші стандарти.

### Основні частини стандарту SQL
1. Data Definition Language (DDL) — визначення схем бази даних (створення, зміна, видалення таблиць).
2. Data Manipulation Language (DML) — робота з даними:
    - `SELECT`
    - `INSERT`
    - `UPDATE`
    - `DELETE`
3. Data Control Language (DCL) — контроль доступу (адміністрування прав).
4. Transaction Control Language (TCL) — робота з транзакціями.

### CRUD-операції
CRUD — це набір базових операцій із даними:
- Create -> `INSERT`
- Read -> `SELECT`
- Update -> `UPDATE`
- Delete -> `DELETE`

Ці чотири операції покривають усі основні потреби при роботі з даними.

---

## 2. INSERT

```sql
INSERT INTO table_name (column1, column2, ...)
VALUES (value1, value2, ...);
```

### Основні особливості INSERT:
- Якщо список колонок не вказаний — значення вставляються у всі колонки таблиці в порядку їх визначення.
- Можна вставляти кілька рядків одразу:
  ```sql
  INSERT INTO student (name, surname, contact_data_id, group_id)
  VALUES 
    ('Андрій', 'Ковальчук', 1, 1),
    ('Марія', 'Коваленко', 2, 2),
    ('Олександр', 'Шевченко', 3, 3);
  ```
- Колонки з DEFAULT значеннями можна пропустити.
- Колонки з автоінкрементом (SERIAL, IDENTITY) зазвичай не вказуються.

---

## 3. SELECT
```sql
SELECT column1, column2
FROM table_name
WHERE condition;
```

### Основні елементи SELECT:
- `*` — вибір усіх колонок (не рекомендується для production-коду).
- `AS` — використання псевдонімів для колонок і таблиць:
  ```sql
  SELECT 
    name || ' ' || surname AS full_name
  FROM student
  WHERE name = 'Андрій' AND surname = 'Ковальчук';
  ```
- Використовуються функції для обробки даних:
  - Рядкові: `CONCAT`, `UPPER`, `LOWER`, `SUBSTRING`
  - Числові: `ROUND`, `ABS`, `CEIL`, `FLOOR`
  - Дати/часу: `NOW()`, `DATE_PART`, `EXTRACT`
- `DISTINCT` — усунення дублікатів:
  ```sql
  SELECT DISTINCT group_id FROM student;
  ```

### Фільтрація (WHERE):
- Оператори порівняння: `=, >, <, >=, <=, <>, !=`
- Діапазони: `BETWEEN value1 AND value2`
- Списки: `IN (value1, value2, ...)`
- Шаблони: `LIKE 'pattern'`
  - Рядкові порівняння — чутливі до регістру.
  - Для нечутливого пошуку використовуються функції (`LOWER`, `UPPER`) або специфічні оператори (наприклад, `ILIKE` у PostgreSQL).
  - Шаблони:
      - `%` — будь-яка кількість символів.
      - `_` — рівно один символ.
- Логічні оператори: `AND`, `OR`, `NOT`
- Перевірка NULL: `IS NULL`, `IS NOT NULL`

### Сортування:  
```sql
ORDER BY column1 [ASC|DESC], column2 [ASC|DESC] [NULLS FIRST|LAST]
```

### Функції агрегації
- `COUNT`, `SUM`, `AVG`, `MIN`, `MAX`.
- Агрегують дані та повертають лише один рядок.  

Приклад:
```sql
SELECT COUNT(*) FROM student;
SELECT COUNT(DISTINCT group_id) FROM student;
```

## 4. UPDATE
```sql
UPDATE table_name
SET column1 = value1, column2 = value2
WHERE condition;
```

### Основні особливості UPDATE:
- Якщо `WHERE` не вказати — оновляться **всі рядки** таблиці.
- Можна оновлювати кілька колонок одночасно:
  ```sql
  UPDATE student
  SET 
    name = 'Андрій',
    surname = 'Ковальчук',
    contact_data_id = 1,
    group_id = 102
  WHERE student_id = 1;
  ```

### Безпечні практики:
- Спочатку перевірте, які рядки будуть оновлені, за допомогою SELECT

---

## 5. DELETE
```sql
DELETE FROM table_name
WHERE condition;
```

### Основні особливості DELETE:
- Якщо не вказати `WHERE` — видаляються **усі рядки** таблиці.
- DELETE видаляє рядки, але не скидає лічильники автоінкременту.

### TRUNCATE — швидке видалення всіх даних:
```sql
TRUNCATE TABLE student;
```
- Видаляє всі рядки з таблиці
- Працює швидше, ніж `DELETE` без `WHERE`
- Скидає лічильники автоінкременту (в більшості СУБД)
- Не завжди підтримує `ROLLBACK` (залежить від СУБД)

### Безпечні практики:
- Спочатку перевірте, які рядки будуть видалені, за допомогою SELECT
- Розгляньте можливість використання "м'якого видалення" (soft delete) замість фізичного:
  ```sql
  -- Припустимо, що ми додали колонку is_deleted до таблиці student
  UPDATE student SET is_deleted = TRUE WHERE name = 'Андрій' AND surname = 'Ковальчук';
  ```

---

## 6. Практична частина лекції

Для демонстрації запитів підчас лекції, попередньо було підготовано синтетичні дані, запити знаходяться у [файлі](../../scripts/insert-data.sql).

Підчас лекції було розроблено наступні запити:

```sql

```

Всі запити також можна знайти у [файлі](../../scripts/crud.sql).

---

## 6. Висновки
- SQL забезпечує стандартний спосіб роботи з даними.
- Різні СУБД імплементують деякі частини стандарту SQL по-різному.
- Основна робота з базою даних — це написання запитів (`SELECT` займає до 70–80% практичної роботи).
- Важливо перевіряти результати перед виконанням операцій, що змінюють дані (`UPDATE`, `DELETE`).

### 7. Додаткові ресурси:
- [Mode Analytics SQL Tutorial](https://mode.com/sql-tutorial/)
- [SQLZoo - Interactive SQL Exercises](https://sqlzoo.net/)
